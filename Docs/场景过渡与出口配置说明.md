# 场景过渡与出口配置说明

从 OpeningStory 进入正式游戏场景起，所有场景切换统一走**全局过渡 UI + 加载进度**，在 Persistent 配置一次即可全局生效；每个场景的出口由**各 Trigger 独立配置**目标场景。

---

## 1. 全局过渡（Persistent 配置一次）

### SceneTransitionManager

- **位置**：由 GameManager 在 Persistent 场景启动时自动创建（无需在场景里拖预制体），也可在 Persistent 里手动放一个并配置。
- **作用**：提供「黑底 + Loading 文案 + 进度条」的过渡界面，用 `LoadSceneAsync` 加载目标场景并刷新进度。
- **配置**（在 Inspector）：
  - **Loading Panel Prefab**：留空则运行时自动生成简易 UI；若有自定义过渡界面预制体可拖入。
  - **Fade In Duration** / **Fade Out Duration**：黑屏淡入、淡出时长。
  - **Minimum Display Time**：过渡界面最少显示时间，避免一闪而过。

### 谁在调用

- **OpeningStory 的 Start 按钮**：`LoadSceneOnClick` 会优先调用 `SceneTransitionManager.LoadSceneWithTransition(sceneName)`，进入 HomeScene 时即带过渡与进度条。
- **关卡内出口**：各场景的 `SceneExitTrigger` 在玩家进入后调用 `SceneTransitionManager.LoadSceneWithTransition(targetSceneName)`。

---

## 2. 每个场景、每个 Trigger 独立配置出口

### SceneExitTrigger

- **挂在**：带 2D Trigger 的 Collider 的物体上（如关卡出口区域）。
- **配置**：
  - **Target Scene Name**：玩家进入后要加载的场景名（如 `HomeScene`、`TestScene`）。
  - **Player Tag**：默认 `"Player"`，可按需改。
- **行为**：玩家（Tag 匹配）进入 Trigger → 调用 `SceneTransitionManager.LoadSceneWithTransition(targetSceneName)`，无其它依赖。

### LevelEndTrigger

- 已移除，统一使用 **SceneExitTrigger**。

---

## 3. GameSceneManager 的职责（仅本场景）

- **只负责**：Cinemachine VCam 的切换与跟拍、Timeline 播放、传送点等**本场景内**逻辑。
- **不再负责**：下一场景名、过渡场景、关卡结束时的场景加载；这些全部交给各 Trigger + SceneTransitionManager。

---

## 4. 流程小结

| 从哪里 | 到哪里 | 怎么切 |
|--------|--------|--------|
| MainMenu 点 Start | OpeningStory | GameManager.LoadNewGame() → 直接 LoadScene(OpeningStory) |
| OpeningStory 点 Start | HomeScene | LoadSceneOnClick → SceneTransitionManager.LoadSceneWithTransition("HomeScene") |
| 任意玩法场景的出口 Trigger | 配置的目标场景 | SceneExitTrigger → SceneTransitionManager.LoadSceneWithTransition(targetSceneName) |

全局过渡 UI 和时长只在 **Persistent 的 SceneTransitionManager** 里配置一次；每个场景的出口由**该场景内的每个 Trigger** 自己填 **Target Scene Name** 即可。
