# 主界面 (MainMenu) 与存档配置说明

本文档说明主界面的进入游戏、保存、读取、退出逻辑，以及如何与 GameManager、场景切换整合。

---

## 1. 流程概览

### 启动流程
1. 游戏启动 → 加载 **Persistent** 场景（含 GameManager）
2. GameManager 加载 **startSceneName**（默认 MainMenu）为 Additive 场景
3. 主界面显示 Start、Load、Save、Exit 按钮

### 按钮逻辑
| 按钮 | 行为 |
|------|------|
| **Start** | 新游戏 → 根据配置进入过渡/剧情场景或直接进入首个玩法场景 |
| **Load** | 读取存档 → 加载存档中记录的场景 |
| **Save** | 保存当前游戏（主界面时禁用） |
| **Exit** | 退出应用 |

---

## 2. 脚本与职责

| 脚本 | 职责 |
|------|------|
| `MainMenuController` | 主界面按钮逻辑，绑定 Start/Load/Save/Exit |
| `SaveSystem` | 存档读写，当前保存场景名，预留背包/剧情扩展 |
| `GameManager` | 加载场景、新游戏、读档、返回主菜单 |

---

## 3. 配置说明

### 3.1 GameManager（Persistent 场景）

| 字段 | 说明 |
|------|------|
| **Start Scene Name** | 游戏启动时加载的首个场景，建议设为 `MainMenu` |
| **First Game Scene Name** | 新游戏要去的首个玩法场景，如 `HomeScene`、`ExplorationScene` |
| **First Time Transition Scene Name** | 初次进入游戏时的过渡/剧情场景；留空则直接进入 `firstGameSceneName` |

**示例**：
- 直接进玩法：`firstTimeTransitionSceneName` 留空
- 先播剧情再进玩法：`firstTimeTransitionSceneName` = `StoryIntroScene` 或 `TransitionScene`

### 3.2 MainMenu 场景

1. 在 Canvas 或任意 GameObject 上添加 **MainMenuController** 脚本
2. 按钮按名称 `Start`、`Load`、`Save`、`Exit` 自动查找；也可在 Inspector 中手动拖入
3. 若没有 Save 按钮（当前 MainMenu 仅有 Start、Load、Exit），Save 相关逻辑会被跳过
4. 按钮需为 Button 组件，且 GameObject 名称与上述一致

### 3.3 Build Settings

需包含以下场景（顺序示例）：
1. Persistent
2. MainMenu
3. HomeScene / ExplorationScene 等玩法场景
4. 过渡/剧情场景（若有）

---

## 4. 存档数据

当前 `SaveData` 包含：
- `version`：版本号，便于后续兼容
- `sceneName`：存档时的场景名
- `saveTimeTicks`：存档时间

预留字段（可后续扩展）：
- 过渡/剧情进度
- 背包物品
- 僵尸列表
- 玩家位置等

存档文件路径：`Application.persistentDataPath/save.json`

---

## 5. 游戏中保存

在玩法场景中，可通过以下方式保存：
- 暂停菜单调用 `SaveSystem.Save()`
- 或调用 `MainMenuController.SaveAndReturnToMainMenu()` 保存并返回主菜单

若需要在玩法场景内添加「保存」按钮，可新建脚本调用 `SaveSystem.Save()`，或引用 `MainMenuController` 调用 `SaveAndReturnToMainMenu()`。

---

## 6. 返回主菜单

任意场景中调用 `GameManager.Instance.LoadMainMenu()` 即可返回主界面。

---

## 7. 过渡场景整合

当 `firstTimeTransitionSceneName` 有值时，新游戏流程为：
1. 设置 `TransitionSceneData.Set(firstGameSceneName)`
2. 加载 `firstTimeTransitionSceneName`
3. 过渡场景的 `TransitionSceneController` 显示文字/剧情后加载 `firstGameSceneName`

与现有 `GameSceneManager` → `TransitionScene` → 下一关卡的流程一致，复用 `TransitionSceneData` 与 `TransitionSceneController`。
